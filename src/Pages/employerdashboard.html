<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Migarant Care</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <meta name="google" content="notranslate">
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en', 
                includedLanguages: 'en,ta,hi', 
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@600;700&family=Ubuntu:wght@400;500&display=swap" rel="stylesheet"> 

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/pages.css" rel="stylesheet">
</head>

<body style="margin-bottom: -30%;">

    <div id="google_translate_element" style="position: fixed; bottom: 10px; right: 10px; z-index: 999;"></div>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <nav class="navbar navbar-expand-lg bg-white navbar-light shadow sticky-top p-0">
        <a href="/home" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
            <h2 class="m-0 text-primary"></i>MigrantCare</h2>
        </a>
        <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto p-4 p-lg-0">
                <a href="/home" class="nav-item nav-link">Home</a>
                <a href="/map" class="nav-item nav-link">Map</a>
                <a href="/about" class="nav-item nav-link">About</a>
            </div>
            <img src="#" id="user-pic" alt="profile" onclick="toggleDropdown()">
            <div class="dropdown" id="dropdownMenu">
                <div class="menu">
                    <div class="info">
                        <img src="#" id="img" alt="user">
                        <h2 id="user">User</h2>
                    </div>
                    <hr>
                    <a href="/employerprofile" class="link">
                        <img src="img/profile.png" alt="profile">
                        <p>Profile</p>
                    </a>
                    <a href="/employerdashboard" class="link">
                        <img src="img/dashboard.png" height="28px" alt="Dashboard">
                        <p>Dashboard</p>
                    </a>
                    <button class="theme link" id="dark-mode-toggle" style="background-color:transparent; border: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M504-425Zm20 385H420l20-12.5q20-12.5 43.5-28t43.5-28l20-12.5q81-6 149.5-49T805-285q-86-8-163-43.5T504-425q-61-61-97-138t-43-163q-77 43-120.5 118.5T200-444v12l-12 5.5q-12 5.5-26.5 11.5T135-403.5l-12 5.5q-2-11-2.5-23t-.5-23q0-146 93-257.5T450-840q-18 99 11 193.5T561-481q71 71 165.5 100T920-370q-26 144-138 237T524-40Zm-284-80h180q25 0 42.5-17.5T480-180q0-25-17-42.5T422-240h-52l-20-48q-14-33-44-52.5T240-360q-50 0-85 34.5T120-240q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T40-240q0-83 58.5-141.5T240-440q60 0 109.5 32.5T423-320q57 2 97 42.5t40 97.5q0 58-41 99t-99 41H240Z"/></svg>
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#ffff00"><path d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Zm326-268Z"/></svg>
                        <p id="dark-mode-label">Dark Mode</p>
                    </button>
                    <a onclick="logout()" class="link">
                        <img src="img/logout.png" alt="logout">
                        <p>Logout</p>
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Navbar End -->
    <!-- Page Header Start -->
    <div class="container-fluid page-header mb-5 p-0" style="background-image: url(img/carousel-bg-1.jpg);background-size: contain;">
        <div class="container-fluid page-header-inner py-6">
            <div class="container text-center">
                <h1 class="display-3 text-white mb-3 animated slideInDown">Migrant Worker</h1>
            </div>
    <div class="form-container" style="padding: 40px;">
        <h2>Migrant Workers Form</h2>
        <form id="workerForm">
            <div class="form-group">
                <label for="uniqueno">Unique No</label>
                <input type="text" id="uniqueNo" name="uniqueNo" required>
                <img src="img/search.png" alt="Search" style="width: 40px; height: 40px;position: absolute;margin-left: -40px;" onclick="searchEmployee()">
            </div>
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" id="name" name="name" disabled>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="text" id="email" name="email" disabled>
            </div>
            <div class="form-group">
                <label for="district">Native District</label>
                <input type="text" id="district" name="district" disabled>
            </div>
            <div class="form-group">
                <label for="nativeAddress">Native Address</label>
                <input type="text" id="nativeAddress" name="nativeAddress" disabled>
            </div>
            <div class="form-group">
                <label for="mobile">Mobile No</label>
                <input type="text" id="mobile" name="mobile" disabled>
            </div>
            <div class="form-group">
                <label for="aadhaar">Aadhaar No</label>
                <input type="text" id="aadhaar" name="aadhaar" disabled>
            </div>
            <div class="form-group">
                <input type="submit" value="Submit">
            </div>
        </form>
    </div>

    <div class="form-container" style="padding: 40px;"> <!-- Increased padding for better fit -->
        <h2>Saved Workers Data</h2>
        <form id="savedWorkerForm" method="post" action="/addWorker">
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Sl.No.</th>
                            <th>Unique No</th>
                            <th>Name</th>
                            <th>Email</th>  
                            <th>Native District</th>
                            <th>Native Address</th>
                            <th>Mobile No</th>
                            <th>Aadhaar No</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="workerData">
                        <!-- Data will be inserted here dynamically -->
                    </tbody>
                </table>
            </div>
            <button id="save" type="button" onclick="saveWorkers()">Save</button>
        </form>
    </div>

    <script>
        async function searchEmployee() {
            const uniqueNo = document.getElementById('uniqueNo').value;
            try {
                const response = await fetch(`/searchEmployee?uniqueNo=${uniqueNo}`);
                const data = await response.json();
                if (response.ok) {
                    document.getElementById('name').value = data.firstName + ' ' + data.lastName;
                    document.getElementById('email').value = data.email;
                    document.getElementById('district').value = data.permanentDistrict;
                    document.getElementById('nativeAddress').value = data.permanentAddress;
                    document.getElementById('mobile').value = data.phone;
                    document.getElementById('aadhaar').value = data.aadhaarNumber;
                } else {
                    alert('Employee not found');
                }
            } catch (error) {
                console.error('Error fetching employee:', error);
            }
        }

        document.getElementById('workerForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const worker = {
                uniqueNo: document.getElementById('uniqueNo').value,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                district: document.getElementById('district').value,
                nativeAddress: document.getElementById('nativeAddress').value,
                mobile: document.getElementById('mobile').value,
                aadhaar: document.getElementById('aadhaar').value
            };

            const tableBody = document.getElementById('workerData');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td data-label="Sl.No.">${tableBody.children.length + 1}</td>
                <td data-label="Unique No">${worker.uniqueNo}</td>
                <td data-label="Name">${worker.name}</td>
                <td data-label="Email">${worker.email}</td>
                <td data-label="Native District">${worker.district}</td>
                <td data-label="Native Address">${worker.nativeAddress}</td>
                <td data-label="Mobile No">${worker.mobile}</td>
                <td data-label="Aadhaar No">${worker.aadhaar}</td>
                <td data-label="Actions">
                    <img src="img/remove.png" onclick="deleteWorker(this)" alt="Remove" style="width: 40px; height: 40px; margin-left:10px">
                </td>
            `;
            tableBody.appendChild(newRow);

            event.target.reset();
        });

        async function saveWorkers() {
            const tableBody = document.getElementById('workerData');
            const workers = [];
            for (let i = 0; i < tableBody.children.length; i++) {
                const row = tableBody.children[i];
                const worker = {
                    uniqueNo: row.children[1].innerText,
                    name: row.children[2].innerText,
                    email: row.children[3].innerText,
                    district: row.children[4].innerText,
                    nativeAddress: row.children[5].innerText,
                    mobile: row.children[6].innerText,
                    aadhaar: row.children[7].innerText
                };
                workers.push(worker);
            }

            try {
                const response = await fetch('/addWorker', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ workers })
                });
                if (response.ok) {
                    alert('Workers saved successfully');
                } else {
                    alert('Error saving workers');
                }
            } catch (error) {
                console.error('Error saving workers:', error);
            }
        }

        async function loadWorkers() {
            try {
                const response = await fetch('/getEmployerWorkers');
                const data = await response.json();
                if (response.ok) {
                    const tableBody = document.getElementById('workerData');
                    data.forEach((worker, index) => {
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                            <td data-label="Sl.No.">${index + 1}</td>
                            <td data-label="Unique No">${worker.uniqueNo}</td>
                            <td data-label="Name">${worker.name}</td>
                            <td data-label="email">${worker.email}</td>
                            <td data-label="Native District">${worker.district}</td>
                            <td data-label="Native Address">${worker.nativeAddress}</td>
                            <td data-label="Mobile No">${worker.mobile}</td>
                            <td data-label="Aadhaar No">${worker.aadhaar}</td>
                            <td data-label="Actions">
                                <img src="img/remove.png" onclick="deleteWorker(this)" alt="Remove" style="width: 40px; height: 40px; margin-left:10px">
                            </td>
                        `;
                        tableBody.appendChild(newRow);
                    });
                } else {
                    console.error('Error loading workers:', data.message);
                }
            } catch (error) {
                console.error('Error loading workers:', error);
            }
        }

        async function deleteWorker(button) {
            const row = button.parentElement.parentElement;
            const uniqueNo = row.children[1].innerText;

            try {
                const response = await fetch(`/deleteWorker?uniqueNo=${uniqueNo}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    row.remove();
                    alert('Worker deleted successfully');
                } else {
                    alert('Error deleting worker');
                }
            } catch (error) {
                console.error('Error deleting worker:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', loadWorkers);
    </script>


        </div>
    </div>
    <!-- Footer Start -->
    <div class="container-fluid bg-dark text-light footer pt-5 mt-5 wow fadeIn" data-wow-delay="0.1s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-lg-3 col-md-6" style="text-align: center;">
                    <p class="mb-2">&copy; 2025 Migrant Care. All rights reserved.</p>
                    <p class="mb.2"><a href="#">Terms and Conditions</a> | <a href="#">Privacy Policy</a></p>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js" defer></script>
    <script src="js/dashboard.js" defer></script>
    <script>
        function toggleDropdown() {
            document.getElementById('dropdownMenu').classList.toggle('active');
        }
    </script>
</body> 
</html>